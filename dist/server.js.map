{"version":3,"sources":["../server/server.js"],"names":["install","dbUrl","connect","err","db","console","log","app","use","static","json","post","req","res","collection","insertOne","body","send","findAndModify","name","owner","$push","polls","upsert","result","$set","loggedIn","findOne","user","password","login","response","listen"],"mappings":";;AACA;;AACA;;;;AAGA;;;;AACA;;;;AACA;;;;AAPA;AAGA,2BAAiBA,OAAjB;;AAOA;AACA,IAAIC,QAAQ,2BAAZ,C,CAAyC;;AAEzC,qBAAYC,OAAZ,CAAoBD,KAApB,EAA2B,UAACE,GAAD,EAAMC,EAAN,EAAa;AACtC,MAAID,GAAJ,EAAS;AAAC,WAAOA,GAAP;AAAW;;AAErBE,UAAQC,GAAR,CAAY,cAAZ;;AAGA,MAAMC,MAAM,wBAAZ;;AAEAA,MAAIC,GAAJ,CAAQ,kBAAQC,MAAR,CAAe,QAAf,CAAR;AACAF,MAAIC,GAAJ,CAAQ,qBAAWE,IAAX,EAAR;;AAEAH,MAAII,IAAJ,CAAS,UAAT,EAAqB,UAACC,GAAD,EAAKC,GAAL,EAAa;;AAEhCT,OAAGU,UAAH,CAAc,OAAd,EAAuBC,SAAvB,CAAiCH,IAAII,IAArC,EAA2C,YAAM;AAC/CX,cAAQC,GAAR,CAAY,4BAAZ;AACAO,UAAII,IAAJ,CAAS,YAAT;AACD,KAHD;AAID,GAND;;AAQAV,MAAII,IAAJ,CAAS,UAAT,EAAqB,UAACC,GAAD,EAAKC,GAAL,EAAa;AAC9BT,OAAGU,UAAH,CAAc,OAAd,EAAuBI,aAAvB,CACI,EAACC,MAAMP,IAAII,IAAJ,CAASI,KAAhB,EADJ,EAEI,EAFJ,EAES;AACL,MAACC,OAAM,EAACC,OAAMV,IAAII,IAAX,EAAP,EAHJ,EAII,EAACO,QAAO,IAAR,EAJJ,EAKI,UAASpB,GAAT,EAAaqB,MAAb,EAAqB;AACnB,UAAGrB,GAAH,EAAQ;AAAC,eAAOA,GAAP;AAAW;AACpB,KAPN;AASH,GAVD;;AAYAI,MAAII,IAAJ,CAAS,SAAT,EAAoB,UAACC,GAAD,EAAKC,GAAL,EAAa;AAC7BT,OAAGU,UAAH,CAAc,OAAd,EAAuBI,aAAvB,CACI,EAACC,MAAMP,IAAII,IAAJ,CAASG,IAAhB,EADJ,EAEI,EAFJ,EAES;AACL,MAACM,MAAM,EAACC,UAAS,KAAV,EAAP,EAHJ,EAII,EAACH,QAAO,IAAR,EAJJ,EAKI,UAASpB,GAAT,EAAaqB,MAAb,EAAqB;AACnB,UAAGrB,GAAH,EAAQ;AAAC,eAAOA,GAAP;AAAW;AACpB,KAPN;AASH,GAVD;;AAYAI,MAAII,IAAJ,CAAS,QAAT,EAAmB,UAACC,GAAD,EAAKC,GAAL,EAAa;;AAE5BT,OAAGU,UAAH,CAAc,OAAd,EAAuBa,OAAvB,CAA+B,EAACR,MAAKP,IAAII,IAAJ,CAASG,IAAf,EAA/B,EAAqD,UAAChB,GAAD,EAAMyB,IAAN,EAAe;;AAEhE,UAAIzB,GAAJ,EAAS;AAACU,YAAIH,IAAJ,CAASP,GAAT;AAAe;;AAEzB,UAAIyB,IAAJ,EAAU;AACR,YAAIA,KAAKC,QAAL,KAAkBjB,IAAII,IAAJ,CAASa,QAA/B,EAAyC;AACvChB,cAAIH,IAAJ,CAAS,EAACoB,OAAM,SAAP,EAAkBC,UAAUH,IAA5B,EAAT;AACD,SAFD,MAGK;AACHf,cAAIH,IAAJ,CAAS,EAACoB,OAAM,MAAP,EAAeC,UAAU,kBAAzB,EAAT;AACD;AACF,OAPD,MAQK;AACDlB,YAAIH,IAAJ,CAAS,EAACoB,OAAM,MAAP,EAAeC,UAAU,cAAzB,EAAT;AACH;AACJ,KAfD;;AAiBA;;;;;;;;;;;;;;AAgBH,GAnCD;;AAqCAxB,MAAIyB,MAAJ,CAAW,IAAX,EAAiB,YAAU;AACzB3B,YAAQC,GAAR,CAAY,0BAAZ;AACD,GAFD;AAID,CApFD","file":"server.js","sourcesContent":["//'use strict'\r\nimport 'babel-polyfill';\r\nimport SourceMapSupport from 'source-map-support';\r\nSourceMapSupport.install();\r\n\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\n\r\n\r\n//let dbUrl = 'mongodb://127.0.0.1:27017/mydb'; //local db\r\nlet dbUrl = 'mongodb://localhost/local'; //local db\r\n\r\nMongoClient.connect(dbUrl, (err, db) => {\r\n  if (err) {return err};\r\n\r\n  console.log('db connected');\r\n\r\n\r\n  const app = express();\r\n\r\n  app.use(express.static('static'));\r\n  app.use(bodyParser.json());\r\n\r\n  app.post('/addUser', (req,res) => {\r\n\r\n    db.collection('users').insertOne(req.body, () => {\r\n      console.log('new user added to database');\r\n      res.send('user added');\r\n    });\r\n  });\r\n\r\n  app.post('/addPoll', (req,res) => {\r\n      db.collection('users').findAndModify(\r\n          {name: req.body.owner},\r\n          {},  //this must be here to work\r\n          {$push:{polls:req.body}},\r\n          {upsert:true},\r\n          function(err,result) {\r\n            if(err) {return err};\r\n           }\r\n      );\r\n  });\r\n\r\n  app.post('/logOut', (req,res) => {\r\n      db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},  //this must be here to work\r\n          {$set: {loggedIn:false}},\r\n          {upsert:true},\r\n          function(err,result) {\r\n            if(err) {return err};\r\n           }\r\n      );\r\n  });\r\n\r\n  app.post('/logIn', (req,res) => {\r\n\r\n      db.collection('users').findOne({name:req.body.name}, (err, user) => {\r\n\r\n          if (err) {res.json(err);}\r\n\r\n          if (user) {\r\n            if (user.password === req.body.password) {\r\n              res.json({login:'success', response: user});\r\n            }\r\n            else {\r\n              res.json({login:'fail', response: 'Invalid Password'});\r\n            }\r\n          }\r\n          else {\r\n              res.json({login:'fail', response: 'Invalid User'});\r\n          }\r\n      });\r\n\r\n      /*\r\n      let user = db.collection('users').findAndModify(\r\n          {name: req.body.name, password: req.body.password},\r\n          {},  //this must be here to work\r\n          {$set: {loggedIn:true}},\r\n          {new:true},\r\n\r\n      ).then(() => {\r\n        if (user) {\r\n          res.send(JSON.stringify(user));\r\n        }\r\n        else {\r\n          res.send('no match');\r\n        }\r\n\r\n      });*/\r\n  });\r\n\r\n  app.listen(3000, function(){\r\n    console.log('App started on port 3000');\r\n  });\r\n\r\n});"]}