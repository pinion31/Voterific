{"version":3,"sources":["../server/server.js"],"names":["install","dbUrl","connect","err","db","app","use","static","json","post","req","res","console","dir","body","collection","find","name","toArray","user","length","status","send","insertOne","newUser","userCopy","polls","filter","poll","id","findAndModify","$set","new","upsert","result","deleteOne","toString","owner","log","$push","$inc","counter","get","params","map","choices","choice","answer","votes","result2","loggedIn","value","password","login","response","listen"],"mappings":"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","file":"server.js","sourcesContent":["//'use strict'\r\nimport 'babel-polyfill';\r\nimport SourceMapSupport from 'source-map-support';\r\nSourceMapSupport.install();\r\n\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\n\r\n\r\n//let dbUrl = 'mongodb://127.0.0.1:27017/mydb'; //local db\r\nlet dbUrl = 'mongodb://localhost/local'; //local db\r\n\r\nMongoClient.connect(dbUrl, (err, db) => {\r\n  if (err) {return err};\r\n\r\n  const app = express();\r\n\r\n  app.use(express.static('static'));\r\n  app.use(bodyParser.json());\r\n\r\n  //***************ADD NEW USER********************\r\n\r\n  app.post('/addUser', (req,res) => {\r\n\r\n    console.dir(req.body);\r\n    db.collection('users').find({name:req.body.name}).toArray((err, user) => {\r\n      if (user.length > 0) {\r\n           res.status(400).send(false);\r\n         }\r\n      else {\r\n          db.collection('users').insertOne(req.body, (err, newUser) => {\r\n            res.status(201).send(true);\r\n          });\r\n      }\r\n    });\r\n  });\r\n\r\n//**************DELETE POLL***************************\r\n\r\n\r\n app.post('/deletePollForUsers', (req,res) => {\r\n      db.collection('users').find({name: req.body.name})\r\n      .toArray((err,user) => {\r\n        if (err) return err;\r\n\r\n        let userCopy = user;\r\n\r\n        userCopy[0].polls = userCopy[0].polls.filter((poll) => {\r\n          if (poll.id != req.body.id) {\r\n            return poll;\r\n          }\r\n        });\r\n\r\n        db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},\r\n          {$set:{polls:userCopy[0].polls}},\r\n          {new:true},\r\n          {upsert:true},\r\n          function(err, result) {\r\n            if (err) return err;\r\n            res.send(result);\r\n          }\r\n          );\r\n      });\r\n  });\r\n\r\n  //delete polls from collective list\r\n  app.post('/deletePollForAll',(req,res) => {\r\n         db.collection('polls').deleteOne(\r\n          {id: req.body.id.toString(), owner:req.body.name},\r\n          function(err,result) {\r\n             console.log(req.body.id.toString());\r\n             console.log(req.body.name);\r\n            console.dir(result);\r\n            if(err) {return err};\r\n            //res.send(result);\r\n          }\r\n      );\r\n  });\r\n\r\n//**************ADD POLL***************************\r\n\r\n  app.post('/addPoll', (req,res) => {\r\n      db.collection('users').findAndModify(\r\n          {name: req.body.owner},\r\n          {},  //this must be here to work\r\n          {$push:{polls:req.body}, $inc:{counter:1}},\r\n          {upsert:true},\r\n          function(err,result) {\r\n            if(err) {return err};\r\n            res.send(result);\r\n          }\r\n      );\r\n  });\r\n\r\n  //adds polls to collective list\r\n  app.post('/addPollToAll',(req,res) => {\r\n         db.collection('polls').insertOne(\r\n          req.body,\r\n          (err,result) => {\r\n            if (err) {return err};\r\n            res.send(result);\r\n          }\r\n       );\r\n  });\r\n\r\n\r\n//**************GET POLLS***************************\r\n\r\n  //returns all user polls\r\n  app.get('/getAllPolls', (req,res) => {\r\n      db.collection('polls').find({}).toArray((err,result) => {\r\n        if (err) {return err};\r\n        //console.dir(result);\r\n        res.send(result);\r\n      });\r\n  });\r\n\r\n  app.get('/poll/:name/:id', (req,res) => {\r\n      db.collection('polls').find({owner:req.params.name, id:req.params.id}).toArray((err,result) => {\r\n        if (err) {return err};\r\n        //console.dir(result);\r\n        res.send(result);\r\n      });\r\n  });\r\n\r\n//**************ANSWER POLL***************************\r\n\r\n  app.post('/answerPollForUsers', (req,res) => {\r\n      db.collection('users').find({name:req.body.name}).toArray((err,user) => {\r\n        if (err) return err;\r\n\r\n        let userCopy = user;\r\n        userCopy[0].polls.map((poll) => {\r\n           if (poll.id === req.body.id) {\r\n              poll.choices.map((choice => {\r\n                if (choice.choice === req.body.answer) {\r\n                  choice.votes++;\r\n                }\r\n              }));\r\n           }\r\n        });\r\n\r\n        db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},\r\n          {$set:{polls:userCopy[0].polls}},\r\n          {new:true},\r\n          {upsert:true},\r\n          function(err, result) {\r\n            if (err) return err;\r\n           // res.send(result);\r\n          }\r\n          );\r\n\r\n      });\r\n\r\n\r\n  });\r\n\r\n  app.post('/answerPollForAll', (req,res) => {\r\n       db.collection('polls').find(\r\n        {\"choices.choice\":req.body.answer})\r\n       .toArray(\r\n          (err, result) => {\r\n            if (err) return err;\r\n            let poll = result;\r\n\r\n            poll[0].choices.map((answer) => {\r\n              if (answer.choice === req.body.answer) {\r\n                answer.votes++;\r\n              }\r\n            });\r\n\r\n            db.collection('polls').findAndModify(\r\n                {\"choices.choice\":req.body.answer},\r\n                {},\r\n                {$set:{choices: poll[0].choices}},\r\n                {new:true},\r\n                {upsert:true},\r\n                function(err, result2) {\r\n                  if (err) {console.dir(err);};\r\n                  res.send(result2);\r\n                }\r\n            );\r\n          }\r\n        );\r\n  });\r\n\r\n//**************LOG OUT***************************\r\n\r\n  app.post('/logOut', (req,res) => {\r\n      db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},  //this must be here to work\r\n          {$set: {loggedIn:false}},\r\n          {upsert:true},\r\n          function(err,result) {\r\n            if(err) {return err};\r\n            res.send(result);\r\n           }\r\n      );\r\n  });\r\n//**************LOG IN***************************\r\n  app.post('/logIn', (req,res) => {\r\n\r\n       db.collection('users').findAndModify(\r\n          {name:req.body.name},\r\n          {},\r\n          {$set: {loggedIn:true}}, //true is being set for correct login but wrong password\r\n          {new:true},\r\n          (err, user) => {\r\n          if (err) {res.json(err);}\r\n\r\n          if (user.value) {\r\n            if (user.value.password === req.body.password) {\r\n              res.json({login:'success', response: user.value});\r\n            }\r\n            else {\r\n              res.json({login:'fail', response: 'Invalid Password'});\r\n            }\r\n          }\r\n          else {\r\n              res.json({login:'fail', response: 'Invalid User'});\r\n          }\r\n      });\r\n      /*\r\n      db.collection('users').findOne({name:req.body.name}, (err, user) => {\r\n\r\n          if (err) {res.json(err);}\r\n\r\n          if (user) {\r\n            if (user.password === req.body.password) {\r\n              res.json({login:'success', response: user});\r\n            }\r\n            else {\r\n              res.json({login:'fail', response: 'Invalid Password'});\r\n            }\r\n          }\r\n          else {\r\n              res.json({login:'fail', response: 'Invalid User'});\r\n          }\r\n      });*/\r\n\r\n  });\r\n\r\n  app.get('*', (req,res) => {\r\n    res.send('no match');\r\n\r\n  });\r\n\r\n  app.listen(3000, function(){\r\n    console.log('App started on port 3000');\r\n  });\r\n\r\n});"]}