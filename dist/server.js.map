{"version":3,"sources":["../server/server.js"],"names":["install","dbUrl","process","env","MONGOLAB_URI","connect","err","db","app","use","static","json","post","req","res","collection","find","name","body","toArray","user","length","status","send","insertOne","userCopy","polls","filter","poll","id","findAndModify","$set","new","upsert","result","deleteOne","toString","owner","$push","$inc","counter","get","params","map","choices","choice","answer","votes","result2","console","dir","loggedIn","value","password","login","response","listen","PORT","log"],"mappings":"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","file":"server.js","sourcesContent":["// 'use strict'\r\nimport 'babel-polyfill';\r\nimport SourceMapSupport from 'source-map-support';\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\n\r\nSourceMapSupport.install();\r\n\r\n// const dbUrl = 'mongodb://localhost/local'; // local db\r\nconst dbUrl = process.env.MONGOLAB_URI; // production db\r\n\r\nMongoClient.connect(dbUrl, (err, db) => {\r\n  if (err) { return err; }\r\n\r\n  const app = express();\r\n\r\n  app.use(express.static('static'));\r\n  app.use(bodyParser.json());\r\n\r\n  //* **************ADD NEW USER********************\r\n  app.post('/addUser', (req, res) => {\r\n    db.collection('users').find({name: req.body.name}).toArray((err, user) => {\r\n      if (err) return err;\r\n      if (user.length > 0) {\r\n        res.status(400).send(false);\r\n      } else {\r\n        db.collection('users').insertOne(req.body, () => {\r\n          res.status(201).send(true);\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  //* *************DELETE POLL***************************\r\n  app.post('/deletePollForUsers', (req, res) => {\r\n    db.collection('users').find({name: req.body.name})\r\n      .toArray((err, user) => {\r\n        if (err) return err;\r\n\r\n        const userCopy = user;\r\n\r\n        userCopy[0].polls = userCopy[0].polls.filter((poll) => {\r\n          if (poll.id !== req.body.id) {\r\n            return poll;\r\n          }\r\n        });\r\n\r\n        db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},\r\n          {$set: {polls: userCopy[0].polls}},\r\n          {new: true},\r\n          {upsert: true},\r\n          (err, result) => {\r\n            if (err) return err;\r\n            res.send(result);\r\n          },\r\n        );\r\n      });\r\n  });\r\n\r\n  // delete polls from collective list\r\n  app.post('/deletePollForAll', (req) => {\r\n    db.collection('polls').deleteOne(\r\n      {id: req.body.id.toString(), owner: req.body.name},\r\n      (err) => {\r\n        if (err) { return err; }\r\n      },\r\n    );\r\n  });\r\n\r\n  //* *************ADD POLL***************************\r\n\r\n  app.post('/addPoll', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.owner},\r\n      {}, // this must be here to work\r\n      {$push: {polls: req.body}, $inc: {counter: 1}},\r\n      {upsert: true},\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n\r\n  // adds polls to collective list\r\n  app.post('/addPollToAll', (req, res) => {\r\n    db.collection('polls').insertOne(\r\n      req.body,\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n\r\n  //* *************GET POLLS***************************\r\n\r\n  // returns all user polls\r\n  app.get('/getAllPolls', (req, res) => {\r\n    db.collection('polls').find({}).toArray((err, result) => {\r\n      if (err) { return err; }\r\n      res.send(result);\r\n    });\r\n  });\r\n\r\n  app.get('/poll/:name/:id', (req, res) => {\r\n    db.collection('polls').find({owner: req.params.name, id: req.params.id}).toArray((err, result) => {\r\n      if (err) { return err; }\r\n      res.send(result);\r\n    });\r\n  });\r\n\r\n  //* *************ANSWER POLL***************************\r\n\r\n  app.post('/answerPollForUsers', (req) => {\r\n    db.collection('users').find({name: req.body.name}).toArray((err, user) => {\r\n      if (err) return err;\r\n\r\n      const userCopy = user;\r\n      userCopy[0].polls.map((poll) => {\r\n        if (poll.id === req.body.id) {\r\n          poll.choices.map(((choice) => {\r\n            if (choice.choice === req.body.answer) {\r\n              choice.votes++;\r\n            }\r\n          }));\r\n        }\r\n      });\r\n\r\n      db.collection('users').findAndModify(\r\n        {name: req.body.name},\r\n        {},\r\n        {$set: {polls: userCopy[0].polls}},\r\n        {new: true},\r\n        {upsert: true},\r\n        (err) => {\r\n          if (err) return err;\r\n        },\r\n      );\r\n    });\r\n  });\r\n\r\n  app.post('/answerPollForAll', (req, res) => {\r\n    db.collection('polls').find(\r\n      {'choices.choice': req.body.answer})\r\n      .toArray(\r\n        (err, result) => {\r\n          if (err) return err;\r\n          const poll = result;\r\n\r\n          poll[0].choices.map((answer) => {\r\n            if (answer.choice === req.body.answer) {\r\n              answer.votes++;\r\n            }\r\n          });\r\n\r\n          db.collection('polls').findAndModify(\r\n            {'choices.choice': req.body.answer},\r\n            {},\r\n            {$set: {choices: poll[0].choices}},\r\n            {new: true},\r\n            {upsert: true},\r\n            (err, result2) => {\r\n              if (err) { console.dir(err); }\r\n              res.send(result2);\r\n            },\r\n          );\r\n        },\r\n      );\r\n  });\r\n\r\n  //* *************LOG OUT***************************\r\n\r\n  app.post('/logOut', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.name},\r\n      {}, // this must be here to work\r\n      {$set: {loggedIn: false}},\r\n      {upsert: true},\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n  //* *************LOG IN***************************\r\n  app.post('/logIn', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.name},\r\n      {},\r\n      {$set: {loggedIn: true}},\r\n      {new: true},\r\n      (err, user) => {\r\n        if (err) { res.json(err); }\r\n\r\n        if (user.value) {\r\n          if (user.value.password === req.body.password) {\r\n            res.json({login: 'success', response: user.value});\r\n          } else {\r\n            res.json({login: 'fail', response: 'Invalid Password'});\r\n          }\r\n        } else {\r\n          res.json({login: 'fail', response: 'Invalid User'});\r\n        }\r\n      });\r\n  });\r\n\r\n  app.get('*', (req, res) => {\r\n    res.send('no match');\r\n  });\r\n\r\n  app.listen(process.env.PORT || 3000, () => {\r\n    console.log('App started on port 3000');\r\n  });\r\n});\r\n"]}