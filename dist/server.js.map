{"version":3,"sources":["../server/server.js"],"names":["path","require","bcrypt","install","dbUrl","process","env","MONGOLAB_URI","connect","err","db","app","use","static","json","post","req","res","collection","find","name","body","toArray","user","length","status","send","genSalt","salt","hash","password","newUser","insertOne","userCopy","polls","filter","poll","id","findAndModify","$set","new","upsert","result","deleteOne","toString","owner","$push","$inc","counter","get","params","map","choices","choice","answer","votes","result2","console","dir","loggedIn","value","compare","match","login","response","sendFile","resolve","__dirname","listen","PORT","log"],"mappings":"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","file":"server.js","sourcesContent":["// 'use strict'\r\nimport 'babel-polyfill';\r\nimport SourceMapSupport from 'source-map-support';\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\n\r\nconst path = require('path');\r\nconst bcrypt = require('bcryptjs');\r\nSourceMapSupport.install();\r\n\r\n// const dbUrl = 'mongodb://localhost/local'; // local db\r\nconst dbUrl = process.env.MONGOLAB_URI; // production db\r\n\r\nMongoClient.connect(dbUrl, (err, db) => {\r\n  if (err) { return err; }\r\n\r\n  const app = express();\r\n\r\n  app.use(express.static('static'));\r\n  app.use(bodyParser.json());\r\n\r\n  //* **************ADD NEW USER********************\r\n  app.post('/addUser', (req, res) => {\r\n    db.collection('users').find({name: req.body.name}).toArray((err, user) => {\r\n      if (err) return err;\r\n      if (user.length > 0) {\r\n        res.status(400).send(false);\r\n      } else {\r\n        bcrypt.genSalt(10, (err, salt) => {\r\n          bcrypt.hash(req.body.password, salt, (err, hash) => {\r\n              const newUser = req.body;\r\n              newUser.password = hash;\r\n\r\n              db.collection('users').insertOne(newUser, () => {\r\n                res.status(201).send(true);\r\n              });\r\n           });\r\n        });\r\n\r\n\r\n      }\r\n    });\r\n  });\r\n\r\n  //* *************DELETE POLL***************************\r\n  app.post('/deletePollForUsers', (req, res) => {\r\n    db.collection('users').find({name: req.body.name})\r\n      .toArray((err, user) => {\r\n        if (err) return err;\r\n\r\n        const userCopy = user;\r\n\r\n        userCopy[0].polls = userCopy[0].polls.filter((poll) => {\r\n          if (poll.id !== req.body.id) {\r\n            return poll;\r\n          }\r\n        });\r\n\r\n        db.collection('users').findAndModify(\r\n          {name: req.body.name},\r\n          {},\r\n          {$set: {polls: userCopy[0].polls}},\r\n          {new: true},\r\n          {upsert: true},\r\n          (err, result) => {\r\n            if (err) return err;\r\n            res.send(result);\r\n          },\r\n        );\r\n      });\r\n  });\r\n\r\n  // delete polls from collective list\r\n  app.post('/deletePollForAll', (req) => {\r\n    db.collection('polls').deleteOne(\r\n      {id: req.body.id.toString(), owner: req.body.name},\r\n      (err) => {\r\n        if (err) { return err; }\r\n      },\r\n    );\r\n  });\r\n\r\n  //* *************ADD POLL***************************\r\n\r\n  app.post('/addPoll', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.owner},\r\n      {}, // this must be here to work\r\n      {$push: {polls: req.body}, $inc: {counter: 1}},\r\n      {upsert: true},\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n\r\n  // adds polls to collective list\r\n  app.post('/addPollToAll', (req, res) => {\r\n    db.collection('polls').insertOne(\r\n      req.body,\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n\r\n  //* *************GET POLLS***************************\r\n\r\n  // returns all user polls\r\n  app.get('/getAllPolls', (req, res) => {\r\n    db.collection('polls').find({}).toArray((err, result) => {\r\n      if (err) { return err; }\r\n      res.send(result);\r\n    });\r\n  });\r\n\r\n  app.get('/poll/:name/:id', (req, res) => {\r\n    db.collection('polls').find({owner: req.params.name, id: req.params.id}).toArray((err, result) => {\r\n      if (err) { return err; }\r\n      res.send(result);\r\n    });\r\n  });\r\n\r\n  //* *************ANSWER POLL***************************\r\n\r\n  app.post('/answerPollForUsers', (req) => {\r\n    db.collection('users').find({name: req.body.name}).toArray((err, user) => {\r\n      if (err) return err;\r\n\r\n      const userCopy = user;\r\n      userCopy[0].polls.map((poll) => {\r\n        if (poll.id === req.body.id) {\r\n          poll.choices.map(((choice) => {\r\n            if (choice.choice === req.body.answer) {\r\n              choice.votes++;\r\n            }\r\n          }));\r\n        }\r\n      });\r\n\r\n      db.collection('users').findAndModify(\r\n        {name: req.body.name},\r\n        {},\r\n        {$set: {polls: userCopy[0].polls}},\r\n        {new: true},\r\n        {upsert: true},\r\n        (err) => {\r\n          if (err) return err;\r\n        },\r\n      );\r\n    });\r\n  });\r\n\r\n  app.post('/answerPollForAll', (req, res) => {\r\n    db.collection('polls').find(\r\n      {'choices.choice': req.body.answer})\r\n      .toArray(\r\n        (err, result) => {\r\n          if (err) return err;\r\n          const poll = result;\r\n\r\n          poll[0].choices.map((answer) => {\r\n            if (answer.choice === req.body.answer) {\r\n              answer.votes++;\r\n            }\r\n          });\r\n\r\n          db.collection('polls').findAndModify(\r\n            {'choices.choice': req.body.answer},\r\n            {},\r\n            {$set: {choices: poll[0].choices}},\r\n            {new: true},\r\n            {upsert: true},\r\n            (err, result2) => {\r\n              if (err) { console.dir(err); }\r\n              res.send(result2);\r\n            },\r\n          );\r\n        },\r\n      );\r\n  });\r\n\r\n  //* *************LOG OUT***************************\r\n\r\n  app.post('/logOut', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.name},\r\n      {}, // this must be here to work\r\n      {$set: {loggedIn: false}},\r\n      {upsert: true},\r\n      (err, result) => {\r\n        if (err) { return err; }\r\n        res.send(result);\r\n      },\r\n    );\r\n  });\r\n  //* *************LOG IN***************************\r\n  app.post('/logIn', (req, res) => {\r\n    db.collection('users').findAndModify(\r\n      {name: req.body.name},\r\n      {},\r\n      {$set: {loggedIn: true}},\r\n      {new: true},\r\n      (err, user) => {\r\n        if (err) { res.json(err); }\r\n        if (user.value) {\r\n          bcrypt.compare(req.body.password, user.value.password, (err, match) => {\r\n            if (match) {\r\n              res.json({login: 'success', response: user.value});\r\n            } else {\r\n              res.json({login: 'fail', response: 'Invalid Password'});\r\n            }\r\n          });\r\n        } else {\r\n          res.json({login: 'fail', response: 'Invalid User'});\r\n        }\r\n\r\n        /*\r\n        if (user.value) {\r\n          if (user.value.password === req.body.password) {\r\n            res.json({login: 'success', response: user.value});\r\n          } else {\r\n            res.json({login: 'fail', response: 'Invalid Password'});\r\n          }\r\n        } else {\r\n          res.json({login: 'fail', response: 'Invalid User'});\r\n        }*/\r\n      });\r\n  });\r\n\r\n  app.get('*', (req, res) => {\r\n    res.sendFile(path.resolve(__dirname, '../static', 'index.html'));\r\n  });\r\n\r\n  app.listen(process.env.PORT || 3000, () => {\r\n    console.log('App started on port 3000');\r\n  });\r\n});\r\n"]}