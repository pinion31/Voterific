{"version":3,"sources":["../../server/routes/users.js"],"names":["express","require","router","Router","bcrypt","db","post","req","res","newUser","body","payload","console","log","collection","find","name","toArray","err","user","length","status","json","loggedIn","genSalt","salt","hash","password","insertOne","findAndModify","$set","new","value","compare","match","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,SAASH,QAAQ,UAAR,CAAf;AACA,IAAII,WAAJ;;AAEA;AACA;AACAH,OAAOI,IAAP,CAAY,UAAZ,EAAwB,UAACC,GAAD,EAAMC,GAAN,EAAc;AACpCH,OAAKE,IAAIF,EAAT;AACA,MAAMI,UAAUF,IAAIG,IAAJ,CAASC,OAAzB;AACAC,UAAQC,GAAR,CAAYJ,OAAZ;AACAJ,KAAGS,UAAH,CAAc,OAAd,EAAuBC,IAAvB,CAA4B,EAACC,MAAMP,QAAQO,IAAf,EAA5B,EAAkDC,OAAlD,CAA0D,UAACC,GAAD,EAAMC,IAAN,EAAe;AACvE,QAAID,GAAJ,EAAS,OAAOA,GAAP;AACT,QAAIC,KAAKH,IAAL,IAAaG,KAAKC,MAAL,GAAc,CAA/B,EAAkC;AAChCZ,UAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACH,MAAM,SAAP,EAAkBI,UAAU,KAA5B,EAArB;AACD,KAFD,MAEO;AACLnB,aAAOoB,OAAP,CAAe,EAAf,EAAmB,UAACN,GAAD,EAAMO,IAAN,EAAe;AAChCrB,eAAOsB,IAAP,CAAYjB,QAAQkB,QAApB,EAA8BF,IAA9B,EAAoC,UAACP,GAAD,EAAMQ,IAAN,EAAe;AACjDjB,kBAAQkB,QAAR,GAAmBD,IAAnB;;AAEArB,aAAGS,UAAH,CAAc,OAAd,EAAuBc,SAAvB,CAAiCnB,OAAjC,EAA0C,YAAM;AAC9CD,gBAAIa,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACH,MAAMV,QAAQO,IAAf,EAAqBO,UAAU,IAA/B,EAArB;AACD,WAFD;AAGD,SAND;AAOD,OARD;AASD;AACF,GAfD;AAgBD,CApBD;;AAsBArB,OAAOI,IAAP,CAAY,YAAZ,EAA0B,UAACC,GAAD,EAAMC,GAAN,EAAc;AACtCH,OAAKE,IAAIF,EAAT;AACAA,KAAGS,UAAH,CAAc,OAAd,EAAuBe,aAAvB,CACE,EAACb,MAAMT,IAAIG,IAAJ,CAASM,IAAhB,EADF,EAEE,EAFF,EAGE,EAACc,MAAM,EAACP,UAAU,IAAX,EAAP,EAHF,EAIE,EAACQ,KAAK,IAAN,EAJF,EAKE,UAACb,GAAD,EAAMC,IAAN,EAAe;AACb,QAAID,GAAJ,EAAS;AAAEV,UAAIc,IAAJ,CAASJ,GAAT;AAAgB;AAC3BN,YAAQC,GAAR,CAAY,SAAZ,EAAuBM,IAAvB;AACA,QAAIA,KAAKa,KAAL,CAAWL,QAAf,EAAyB;AACvBvB,aAAO6B,OAAP,CAAe1B,IAAIG,IAAJ,CAASiB,QAAxB,EAAkCR,KAAKa,KAAL,CAAWL,QAA7C,EAAuD,UAACT,GAAD,EAAMgB,KAAN,EAAgB;AACrE,YAAIA,KAAJ,EAAW;AACT1B,cAAIc,IAAJ,CAAS,EAACH,MAAMA,KAAKa,KAAL,CAAWhB,IAAlB,EAAwBO,UAAU,IAAlC,EAAT;AACD,SAFD,MAEO;AACLf,cAAIc,IAAJ,CAAS,EAACH,MAAM,kBAAP,EAA2BI,UAAU,KAArC,EAAT;AACD;AACF,OAND;AAOD,KARD,MAQO;AACLf,UAAIc,IAAJ,CAAS,EAACH,MAAM,cAAP,EAAuBI,UAAU,KAAjC,EAAT;AACD;AACF,GAnBH;AAoBD,CAtBD;;AAwBAY,OAAOC,OAAP,GAAiBlC,MAAjB","file":"users.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nlet db;\r\n\r\n//  input: {name: String, password: String, email: String}\r\n//  output: {user: String, loggedIn: Boolean}\r\nrouter.post('/addUser', (req, res) => {\r\n  db = req.db;\r\n  const newUser = req.body.payload;\r\n  console.log(newUser);\r\n  db.collection('users').find({name: newUser.name}).toArray((err, user) => {\r\n    if (err) return err;\r\n    if (user.name && user.length > 0) {\r\n      res.status(400).json({user: 'invalid', loggedIn: false});\r\n    } else {\r\n      bcrypt.genSalt(10, (err, salt) => {\r\n        bcrypt.hash(newUser.password, salt, (err, hash) => {\r\n          newUser.password = hash;\r\n\r\n          db.collection('users').insertOne(newUser, () => {\r\n            res.status(201).json({user: newUser.name, loggedIn: true});\r\n          });\r\n        });\r\n      });\r\n    }\r\n  });\r\n});\r\n\r\nrouter.post('/LoginUser', (req, res) => {\r\n  db = req.db;\r\n  db.collection('users').findAndModify(\r\n    {name: req.body.name},\r\n    {},\r\n    {$set: {loggedIn: true}},\r\n    {new: true},\r\n    (err, user) => {\r\n      if (err) { res.json(err); }\r\n      console.log('at user', user);\r\n      if (user.value.password) {\r\n        bcrypt.compare(req.body.password, user.value.password, (err, match) => {\r\n          if (match) {\r\n            res.json({user: user.value.name, loggedIn: true});\r\n          } else {\r\n            res.json({user: 'Invalid Password', loggedIn: false});\r\n          }\r\n        });\r\n      } else {\r\n        res.json({user: 'Invalid User', loggedIn: false});\r\n      }\r\n    });\r\n});\r\n\r\nmodule.exports = router;\r\n"]}